<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>SURGE </title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #10b981; --text: #f1f5f9; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Inter', 'Noto Sans JP', sans-serif; }
        
        main { max-width: 800px; margin: 50px auto; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        
        /* クイズカード */
        .q-card { background: var(--card); padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.05); }
        .category-tag { background: var(--accent); color: var(--bg); font-size: 0.7rem; font-weight: 800; padding: 4px 12px; border-radius: 50px; text-transform: uppercase; margin-bottom: 15px; display: inline-block; }
        .q-text { font-size: 1.5rem; font-weight: 700; line-height: 1.4; margin-bottom: 30px; }
        
        /* 選択肢 */
        .choices-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .choice-btn { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); color: #fff; padding: 20px; border-radius: 12px; cursor: pointer; transition: 0.3s; font-size: 1rem; text-align: left; }
        .choice-btn:hover { background: rgba(255,255,255,0.1); transform: translateY(-2px); border-color: var(--accent); }
        
        /* ローディングアニメーション */
        .loading { text-align: center; font-size: 1.2rem; opacity: 0.6; padding: 50px; }
        
        /* スコア */
        .score-board { margin-top: 30px; display: flex; gap: 20px; }
        .stat-box { background: var(--card); padding: 15px 25px; border-radius: 12px; flex-grow: 1; text-align: center; }
        .stat-val { display: block; font-size: 1.5rem; font-weight: 700; color: var(--accent); }
    </style>
</head>
<body>

<main>
    <div class="header">
        <h1 style="font-size: 1.2rem; letter-spacing: 2px;">SURGE // API-FETCHER</h1>
        <div id="status" style="font-size: 0.8rem; color: #10b981;">● API CONNECTED</div>
    </div>

    <div id="quiz-container">
        <div class="loading">APIから問題を読み込み中...</div>
    </div>

    <div class="score-board">
        <div class="stat-box">
            <span class="stat-val" id="correct-count">0</span>
            <span style="font-size: 0.7rem; opacity: 0.6;">正解数</span>
        </div>
        <div class="stat-box">
            <span class="stat-val" id="total-count">0</span>
            <span style="font-size: 0.7rem; opacity: 0.6;">挑戦数</span>
        </div>
    </div>
</main>

<script>
    let correctCount = 0;
    let totalCount = 0;

    // APIから問題を取得する関数
    async function fetchQuestion() {
        const container = document.getElementById('quiz-container');
        container.innerHTML = '<div class="loading">新しい問題を生成中...</div>';

        try {
            // Open Trivia DB APIを使用 (難易度:中, 4択問題)
            const response = await fetch('https://opentdb.com/api.php?amount=1&type=multiple');
            const data = await response.json();
            const q = data.results[0];

            // 選択肢をシャッフル
            const choices = [...q.incorrect_answers, q.correct_answer].sort(() => Math.random() - 0.5);

            renderQuestion(q.category, q.question, choices, q.correct_answer);
        } catch (error) {
            container.innerHTML = '<div class="loading" style="color: #ff4757;">APIエラーが発生しました。時間を置いて試してください。</div>';
        }
    }

    // 画面に問題を描画する関数
    function renderQuestion(cat, text, choices, correct) {
        const container = document.getElementById('quiz-container');
        
        // 特殊文字のデコード (API特有の &quot; などを直す)
        const decode = (str) => {
            const txt = document.createElement("textarea");
            txt.innerHTML = str;
            return txt.value;
        };

        let html = `
            <div class="q-card">
                <span class="category-tag">${decode(cat)}</span>
                <div class="q-text">${decode(text)}</div>
                <div class="choices-grid">
        `;

        choices.forEach(choice => {
            html += `<button class="choice-btn" onclick="checkAnswer('${decode(choice)}', '${decode(correct)}')">${decode(choice)}</button>`;
        });

        html += `</div></div>`;
        container.innerHTML = html;
    }

    // 正誤判定
    function checkAnswer(selected, correct) {
        totalCount++;
        if (selected === correct) {
            alert("正解！ Excellent.");
            correctCount++;
        } else {
            alert(`不正解！ 正解は: ${correct}`);
        }
        document.getElementById('correct-count').innerText = correctCount;
        document.getElementById('total-count').innerText = totalCount;
        fetchQuestion(); // 次の問題へ
    }

    // 初回読み込み
    fetchQuestion();
</script>

</body>
</html>
