<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>SURGE SCAN - ç”»åƒã‚¹ã‚­ãƒ£ãƒ³æ¤œç´¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="/favicon.png">
  <style>
    :root { --accent: #4f46e5; --bg: #fdfdfd; }
    body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: #222; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; }

    .scan-container { text-align: center; width: 90%; max-width: 500px; padding: 40px; background: white; border-radius: 32px; box-shadow: 0 15px 40px rgba(0,0,0,0.05); }
    
    /* ã‚¹ã‚­ãƒ£ãƒ³çª“ã®æ¼”å‡º */
    .scan-window {
      width: 240px; height: 240px; margin: 0 auto 30px; border: 3px solid #eee; border-radius: 40px; position: relative;
      display: flex; align-items: center; justify-content: center; background: #fafafa; overflow: hidden;
      cursor: pointer; transition: 0.3s;
    }
    .scan-window:hover { border-color: var(--accent); background: #f5f7ff; }
    
    /* ã‚¹ã‚­ãƒ£ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå®Ÿè¡Œæ™‚ï¼‰ */
    .scan-line {
      position: absolute; width: 100%; height: 4px; background: var(--accent); top: 0; left: 0;
      box-shadow: 0 0 15px var(--accent); display: none; z-index: 10;
    }
    @keyframes scanMove { 0% { top: 0; } 50% { top: 100%; } 100% { top: 0; } }

    .btn-scan {
      background: var(--accent); color: white; padding: 16px 40px; border-radius: 30px; font-weight: bold; border: none; cursor: pointer; font-size: 16px; transition: 0.3s;
    }
    .btn-scan:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(79, 70, 229, 0.3); }

    /* Google CSEã®æ¨™æº–è¦ç´ ã‚’ã€Œæ©Ÿèƒ½ã ã‘ã€ä½¿ã†ãŸã‚ã«éš ã™ */
    #hidden-cse-area {
      position: absolute; width: 1px; height: 1px; overflow: hidden; opacity: 0;
    }

    .status-text { margin-top: 20px; font-size: 14px; color: #888; }
    .back-btn { margin-top: 25px; display: block; color: #999; text-decoration: none; font-size: 14px; }
  </style>
</head>
<body>

  <div class="scan-container">
    <h1 style="font-size: 28px; margin-bottom: 10px;">SURGE <span style="color:var(--accent)">SCAN</span></h1>
    <p style="color:#666; margin-bottom: 30px;">ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ä¼¼ã¦ã„ã‚‹ã‚‚ã®ã‚’æ¤œç´¢</p>

    <div class="scan-window" id="dropArea" onclick="startGoogleScan()">
      <div class="scan-line" id="scanLine"></div>
      <div id="prompt" style="text-align:center;">
        <span style="font-size: 50px;">ğŸ“·</span><br>
        <span style="font-size: 14px; color:#aaa;">ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç”»åƒã‚’é¸æŠ</span>
      </div>
      <img id="preview" src="#" style="display:none; width:100%; height:100%; object-fit:cover; border-radius:36px;">
    </div>

    <button class="btn-scan" onclick="startGoogleScan()">ã‚¹ã‚­ãƒ£ãƒ³ã‚’é–‹å§‹</button>
    <div id="status" class="status-text">Googleãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™</div>

    <a href="/" class="back-btn">â† æ¤œç´¢ã«æˆ»ã‚‹</a>
  </div>

  <div id="hidden-cse-area">
    <div class="gcse-search"></div>
  </div>

  <script>
    // Google CSEãŒèª­ã¿è¾¼ã¾ã‚ŒãŸå¾Œã«ã‚«ãƒ¡ãƒ©ãƒœã‚¿ãƒ³ã‚’æ¢ã™
    function startGoogleScan() {
      // CSEæ¨™æº–ã®ã€Œç”»åƒã§æ¤œç´¢ã€ãƒœã‚¿ãƒ³ï¼ˆã‚«ãƒ¡ãƒ©ã‚¢ã‚¤ã‚³ãƒ³ï¼‰ã®ã‚¯ãƒ©ã‚¹å
      const googleCameraButton = document.querySelector('.gsst_a');
      
      if (googleCameraButton) {
        googleCameraButton.click(); // æœ¬ç‰©ã®ã‚«ãƒ¡ãƒ©ãƒœã‚¿ãƒ³ã‚’æ“¬ä¼¼ã‚¯ãƒªãƒƒã‚¯
        
        // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå§‹ã¾ã£ãŸã‚‰ã‚¹ã‚­ãƒ£ãƒ³æ¼”å‡ºã‚’å…¥ã‚Œã‚‹ï¼ˆä»»æ„ï¼‰
        const observer = new MutationObserver(() => {
          const previewImg = document.getElementById('preview');
          const scanLine = document.getElementById('scanLine');
          // ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚ŒãŸã‚‰æ¼”å‡ºã‚’é–‹å§‹
          scanLine.style.display = 'block';
          scanLine.style.animation = 'scanMove 2s infinite ease-in-out';
        });
        observer.observe(document.body, { childList: true, subtree: true });
      } else {
        alert("Google CSEã®ã€ç”»åƒã«ã‚ˆã‚‹æ¤œç´¢ã€è¨­å®šãŒOFFã«ãªã£ã¦ã„ã‚‹ã‹ã€èª­ã¿è¾¼ã¿ä¸­ã§ã™ã€‚");
      }
    }

    // ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å‡¦ç†ï¼ˆã‚‚ã—å¿…è¦ãªã‚‰ï¼‰
    window.addEventListener('change', (e) => {
      if (e.target.type === 'file') {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            const preview = document.getElementById('preview');
            preview.src = event.target.result;
            preview.style.display = 'block';
            document.getElementById('prompt').style.display = 'none';
          };
          reader.readAsDataURL(file);
        }
      }
    }, true);
  </script>

  <script async src="https://cse.google.com/cse.js?cx=818be131768c247f3"></script>

</body>
</html>
