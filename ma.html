<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>SURGE // Hybrid Markdown Engine</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://unpkg.com/turndown/dist/turndown.js"></script>
    <style>
        :root {
            --bg: #0a0a0c;
            --panel: #16161e;
            --accent: #10b981;
            --text: #c0caf5;
            --border: #292e42;
        }

        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

        header { padding: 15px 25px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }

        /* モード切り替えスイッチ */
        .mode-switcher {
            display: flex; background: #000; padding: 5px; border-radius: 30px; border: 1px solid var(--border);
        }
        .mode-btn {
            padding: 8px 20px; border-radius: 25px; cursor: pointer; font-size: 0.75rem; font-weight: bold;
            transition: 0.3s; border: none; background: none; color: var(--sub-text);
        }
        .mode-btn.active { background: var(--accent); color: #000; }

        .app-container { display: flex; flex-grow: 1; overflow: hidden; }

        /* 左側：エディタ */
        .editor-side { flex: 1; display: flex; flex-direction: column; border-right: 1px solid var(--border); }
        .side-label { padding: 10px 25px; font-size: 0.7rem; font-weight: bold; color: var(--accent); background: #00000033; }
        
        textarea {
            flex: 1; background: var(--panel); color: #fff; border: none; padding: 25px;
            font-family: 'Fira Code', monospace; font-size: 0.95rem; resize: none; outline: none; line-height: 1.6;
        }

        /* 右側：出力エリア */
        .output-side { width: 45%; display: flex; flex-direction: column; background: var(--bg); }
        
        #preview, #raw-output { flex: 1; padding: 25px; overflow-y: auto; }
        #raw-output { display: none; font-family: monospace; white-space: pre-wrap; background: #000; font-size: 0.85rem; }

        /* プレビュー内のMarkdown装飾 */
        #preview h1, #preview h2 { border-bottom: 1px solid var(--border); padding-bottom: 8px; }
        #preview strong { color: var(--accent); }

        .btn { background: var(--accent); color: #000; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <div style="font-weight: bold; letter-spacing: 2px; font-size: 0.9rem;">SURGE // HYBRID ENGINE</div>
    
    <div class="mode-switcher">
        <button id="mode-md2html" class="mode-btn active" onclick="setMode('md2html')">MD → HTML</button>
        <button id="mode-html2md" class="mode-btn" onclick="setMode('html2md')">HTML → MD</button>
    </div>

    <button class="btn" onclick="copyResult()">COPY RESULT</button>
</header>

<div class="app-container">
    <div class="editor-side">
        <div id="input-label" class="side-label">SOURCE: MARKDOWN</div>
        <textarea id="editor" placeholder="ここに入力..." oninput="process()"></textarea>
    </div>

    <div class="output-side">
        <div id="output-label" class="side-label">RESULT: PREVIEW</div>
        <div id="preview"></div>
        <div id="raw-output"></div>
    </div>
</div>

<script>
    let mode = 'md2html'; // 'md2html' または 'html2md'
    const turndownService = new TurndownService({ headingStyle: 'atx' });

    function setMode(newMode) {
        mode = newMode;
        // UIの更新
        document.getElementById('mode-md2html').classList.toggle('active', mode === 'md2html');
        document.getElementById('mode-html2md').classList.toggle('active', mode === 'html2md');
        
        document.getElementById('input-label').innerText = mode === 'md2html' ? 'SOURCE: MARKDOWN' : 'SOURCE: HTML CODE';
        document.getElementById('output-label').innerText = mode === 'md2html' ? 'RESULT: PREVIEW' : 'RESULT: MARKDOWN';
        
        document.getElementById('preview').style.display = mode === 'md2html' ? 'block' : 'none';
        document.getElementById('raw-output').style.display = mode === 'md2html' ? 'none' : 'block';
        
        document.getElementById('editor').value = '';
        document.getElementById('preview').innerHTML = '';
        document.getElementById('raw-output').textContent = '';
    }

    function process() {
        const input = document.getElementById('editor').value;
        const preview = document.getElementById('preview');
        const raw = document.getElementById('raw-output');

        if (mode === 'md2html') {
            // MarkdownをHTMLに変換してプレビュー
            const html = marked.parse(input);
            preview.innerHTML = html;
        } else {
            // HTMLコードをMarkdownに変換
            const markdown = turndownService.turndown(input);
            raw.textContent = markdown;
        }
    }

    function copyResult() {
        const text = mode === 'md2html' ? document.getElementById('preview').innerHTML : document.getElementById('raw-output').textContent;
        navigator.clipboard.writeText(text).then(() => alert("結果をコピーしました"));
    }
</script>

</body>
</html>
